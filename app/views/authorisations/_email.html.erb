<div class="modal-header">
  <p>
    <b><%= (email.participants_with_delivery('from').map {|p| p.fullname + " <" + p.email + ">"}).join(', ') %></b>
  </p>
  <p>to <%= (email.participants_with_delivery('to').map {|p| p.fullname + " <" + p.email + ">"}).join(', ') %>,
    <% if !(email.participants_with_delivery('cc').map {|p| p.fullname}).empty? %>
      <%= (email.participants_with_delivery('cc').map {|p| p.fullname + " <" + p.email + ">"}).join(', ') %>
    <% end %>
    <% if !(email.participants_with_delivery('bcc').map {|p| p.fullname}).empty? %>
      Bcc: <%= (email.participants_with_delivery('bcc').map {|p| p.fullname + " <" + p.email + ">"}).join(', bcc: ') %> </p>
    <% end %>
</div>
<div class="modal-body">
  <% if email.body_html.empty? %>
  	<%= simple_format email.body_text_sections[:main] %>
  	<% if !email.body_text_sections[:expanded].empty? %>
  	  <div class="expanded-email">
  	  	 <a class="btn btn-default btn-xs" role="button" data-toggle="collapse" href="#<%= email.id %>" aria-expanded="false" aria-controls="<%= email.id %>">...</a>
  	  	 <div id="<%= email.id %>" class="panel-collapse collapse">
  	  	 	<%= simple_format email.body_text_sections[:expanded] %>
  	  	 </div>
  	  </div>
  	<% end %>
  <% else %>
  	<%= email.body_html_sections[:main].html_safe %>
  	<% if !email.body_html_sections[:expanded].empty? %>
  	  <div class="expanded-email">
  	  	 <a class="btn btn-default btn-xs" role="button" data-toggle="collapse" href="#<%= email.id %>" aria-expanded="false" aria-controls="<%= email.id %>">...</a>
  	  	 <div id="<%= email.id %>" class="panel-collapse collapse">
  	  	 	<%= email.body_html_sections[:expanded].html_safe %>
  	  	 </div>
  	  </div>
  	<% end %>
  <% end %>
</div>
<p><small>(Testing: <%= email.id %>)</small></p>
<hr class="email-border" />
