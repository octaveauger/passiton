<script type="text/javascript">
  $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();
  });
</script>

<div class="modal-body">
  <div class="row">
    <div class="col-md-9">
      <ul class="list-unstyled">
        <li>
          <strong>
            <% email.participants_with_delivery('from').each do |sender| %>
            <span data-toggle="tooltip" data-placement="bottom" data-html="true" title="<%= sender.first_name + " " + sender.last_name + " (" + sender.company + ") " + sender.email %>">
                <%= sender.first_name + " " + sender.last_name %>
              </span>
            <% end %>
          </strong>
        </li>
        <li>
          <small>
          to
          <% recipients = email.participants_with_delivery('to') + email.participants_with_delivery('cc') %>
          <% recipients.each do |recipient| %>
          <span data-toggle="tooltip" data-placement="bottom" data-html="true" title="<%= recipient.first_name + " " + recipient.last_name + " (" + recipient.company + ") " + recipient.email %>">
              <% if recipient != recipients.last %>
                <%= recipient.first_name %>,
              <% else %>
                <%= recipient.first_name %>
              <% end %>
          </span>
          <% end %>
          </small>
        </li>
      </p>
    </div>
    <div class="col-md-3">
      <p class="text-right"><%= email.email_date.strftime("%d %b %y, %H:%M") %></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12"
      <% if email.body_html.empty? %>
      	<%= simple_format email.body_text_sections[:main] %>
      	<% if !email.body_text_sections[:expanded].empty? %>
      	  <div class="expanded-email">
      	  	 <a class="btn btn-default btn-xs" role="button" data-toggle="collapse" href="#<%= email.id %>" aria-expanded="false" aria-controls="<%= email.id %>">...</a>
      	  	 <div id="<%= email.id %>" class="panel-collapse collapse">
      	  	 	<%= simple_format email.body_text_sections[:expanded] %>
      	  	 </div>
      	  </div>
      	<% end %>
      <% else %>
      	<%= email.body_html_sections[:main].html_safe %>
      	<% if !email.body_html_sections[:expanded].empty? %>
      	  <div class="expanded-email">
      	  	 <a class="btn btn-default btn-xs" role="button" data-toggle="collapse" href="#<%= email.id %>" aria-expanded="false" aria-controls="<%= email.id %>">...</a>
      	  	 <div id="<%= email.id %>" class="panel-collapse collapse">
      	  	 	<%= email.body_html_sections[:expanded].html_safe %>
      	  	 </div>
      	  </div>
      	<% end %>
      <% end %>
    </div>
  </div>
  <hr class="hr-dotted">
  <ul class="no-bullet">
    <%= render partial: 'authorisations/attachment', collection: email.message_attachments %>
  </ul>
  <% if !Rails.env.production? %>
    <p><small>(Testing: <%= email.id %>)</small></p>
  <% end %>

</div>
